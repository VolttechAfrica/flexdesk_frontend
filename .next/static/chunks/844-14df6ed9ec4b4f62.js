"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[844],{20395:(e,t,r)=>{r.d(t,{Rm:()=>n});var s=function(e){return e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR",e[e.FATAL=4]="FATAL",e}({});class o{static getInstance(){return o.instance||(o.instance=new o),o.instance}shouldLog(e){return e>=this.logLevel}formatMessage(e,t,r,s,o){let i={timestamp:new Date().toISOString(),level:e,message:t,context:r,error:s,data:o};return s&&(i.error={name:s.name,message:s.message,stack:this.isDevelopment?s.stack:void 0}),i}outputLog(e){if(!this.shouldLog(e.level))return;let{timestamp:t,level:r,message:o,context:i,error:n,data:a}=e,u=s[r],c="[".concat(t,"] [").concat(u,"]");if(this.isDevelopment){this.getConsoleMethod(r)(c,o,{context:i,error:n,data:a});return}this.isProduction&&this.getConsoleMethod(r)(JSON.stringify(e))}getConsoleMethod(e){switch(e){case 0:return console.debug;case 1:return console.info;case 2:return console.warn;case 3:case 4:return console.error;default:return console.log}}debug(e,t,r){this.outputLog(this.formatMessage(0,e,t,void 0,r))}info(e,t,r){this.outputLog(this.formatMessage(1,e,t,void 0,r))}warn(e,t,r){this.outputLog(this.formatMessage(2,e,t,void 0,r))}error(e,t,r,s){this.outputLog(this.formatMessage(3,e,r,t,s))}fatal(e,t,r,s){this.outputLog(this.formatMessage(4,e,r,t,s))}logApiRequest(e,t,r,s){this.info("API Request: ".concat(e," ").concat(t),{requestId:r,action:"api_request"},s)}logApiResponse(e,t,r,s){this.info("API Response: ".concat(e," ").concat(t),{requestId:r,action:"api_response"},s)}logApiError(e,t,r,s,o){this.error("API Error: ".concat(e," ").concat(t),s,{requestId:r,action:"api_error"},o)}logAuthEvent(e,t,r){this.info("Auth Event: ".concat(e),{userId:t,action:"auth_event"},r)}logUserAction(e,t,r){this.info("User Action: ".concat(e),{userId:t,action:"user_action"},r)}logSecurityEvent(e,t,r){this.warn("Security Event: ".concat(e),{userId:t,action:"security_event"},r)}logPerformance(e,t,r){this.info("Performance: ".concat(e," took ").concat(t,"ms"),r,{duration:t,operation:e})}logErrorBoundary(e,t,r){this.error("React Error Boundary caught error",e,r,{errorInfo:t})}setLogLevel(e){this.logLevel=e}getLogLevel(){return this.logLevel}isLevelEnabled(e){return this.shouldLog(e)}constructor(){this.isDevelopment=!1,this.isProduction=!0;let e="INFO";e?this.logLevel=s[e.toUpperCase()]||1:this.logLevel=+!this.isDevelopment}}let i=o.getInstance(),n={debug:(e,t,r)=>i.debug(e,t,r),info:(e,t,r)=>i.info(e,t,r),warn:(e,t,r)=>i.warn(e,t,r),error:(e,t,r,s)=>i.error(e,t,r,s),fatal:(e,t,r,s)=>i.fatal(e,t,r,s),api:{request:(e,t,r,s)=>i.logApiRequest(e,t,r,s),response:(e,t,r,s)=>i.logApiResponse(e,t,r,s),error:(e,t,r,s,o)=>i.logApiError(e,t,r,s,o)},auth:(e,t,r)=>i.logAuthEvent(e,t,r),user:(e,t,r)=>i.logUserAction(e,t,r),security:(e,t,r)=>i.logSecurityEvent(e,t,r),performance:(e,t,r)=>i.logPerformance(e,t,r),errorBoundary:(e,t,r)=>i.logErrorBoundary(e,t,r)}},92844:(e,t,r)=>{r.d(t,{uE:()=>l});var s=r(23464),o=r(20395),i=r(49509);let n=()=>{let e="http://192.168.2.43:8000/api/v2";if(!e)throw Error("NEXT_PUBLIC_API_BASE_URL environment variable is required");return{baseURL:e,timeout:parseInt("30000"),retries:parseInt("3"),retryDelay:parseInt("1000")}},a="/auth/token/refresh";class u extends Error{constructor(e,t,r,s,o){super(e),this.name="ApiClientError",this.code=t,this.status=r,this.details=s,this.requestId=o}}class c{setupInterceptors(){this.client.interceptors.request.use(this.requestInterceptor,this.requestErrorInterceptor),this.client.interceptors.response.use(this.responseInterceptor,this.responseErrorInterceptor)}shouldRetry(e){return e>=500||429===e}canRetry(e){return!!e&&(e._retryCount||0)<(this.defaultConfig.retries||0)}async retryRequest(e){var t;e._retry=!0,e._retryCount=(e._retryCount||0)+1;let r=(this.defaultConfig.retryDelay||1e3)*Math.pow(2,e._retryCount-1);return o.Rm.info("Retrying request (attempt ".concat(e._retryCount,")"),{requestId:null===(t=e.headers)||void 0===t?void 0:t["X-Request-ID"],delay:r,url:e.url}),await this.sleep(r),this.client.request(e)}parseErrorResponse(e,t,r){return e&&"object"==typeof e&&e.error?new u((null==e?void 0:e.message)||"An error occurred",e.error.code||"UNKNOWN_ERROR",t,e.error.details,r):new u({400:"Bad request. Please check your input.",401:"Authentication required. Please log in.",403:"Access denied. You do not have permission to perform this action.",404:"The requested resource was not found.",409:"Conflict. The resource already exists or is in use.",422:"Validation error. Please check your input.",429:"Too many requests. Please try again later.",500:"Internal server error. Please try again later.",502:"Bad gateway. The server is temporarily unavailable.",503:"Service unavailable. Please try again later.",504:"Gateway timeout. The request took too long to process."}[t]||"An unexpected error occurred","HTTP_".concat(t),t,{originalData:e},r)}generateRequestId(){return"req_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))}sleep(e){return new Promise(t=>setTimeout(t,e))}getCsrfToken(){var e;let t=document.querySelector('meta[name="csrf-token"]');return t?t.getAttribute("content"):(null===(e=document.cookie.split("; ").find(e=>e.startsWith("csrf-token=")))||void 0===e?void 0:e.split("=")[1])||null}getAccessToken(){var e;return(null===(e=document.cookie.split("; ").find(e=>e.startsWith("access_token=")))||void 0===e?void 0:e.split("=")[1])||null}getRefreshToken(){var e;return(null===(e=document.cookie.split("; ").find(e=>e.startsWith("refresh_token=")))||void 0===e?void 0:e.split("=")[1])||null}isRefreshUrl(e){if(!e)return!1;try{return e.endsWith(a)||new URL(e,window.location.origin).pathname.endsWith(a)}catch(t){return e.endsWith(a)}}isPublicRoute(e){if(!e)return!1;let t=["/auth/login","/auth/register","/auth/forgot-password","/auth/reset-password","/health","/api/health"];try{let r=e.startsWith("http")?new URL(e).pathname:e;return t.some(e=>r.startsWith(e))}catch(r){return t.some(t=>e.startsWith(t))}}async refreshAuthToken(){if(this.isRefreshing)return new Promise((e,t)=>{this.failedQueue.push({resolve:e,reject:t})});this.isRefreshing=!0;try{let e=this.getAccessToken(),t=this.getRefreshToken();if(!e||!t)throw Error("Missing tokens for refresh");let{authService:s}=await r.e(525).then(r.bind(r,35525));await s.refreshToken({token:e});let i=this.getAccessToken();return this.failedQueue.forEach(e=>{let{resolve:t}=e;t(i)}),this.failedQueue=[],o.Rm.info("Token refreshed successfully",{action:"token_refresh_success"}),i}catch(e){throw this.failedQueue.forEach(t=>{let{reject:r}=t;r(e)}),this.failedQueue=[],o.Rm.error("Token refresh failed",e,{action:"token_refresh_failed"}),e}finally{this.isRefreshing=!1}}handleAuthFailure(){document.cookie="access_token=; path=/; max-age=0; secure; samesite=strict",document.cookie="refresh_token=; path=/; max-age=0; secure; samesite=strict",o.Rm.warn("Authentication failed, redirecting to login",{action:"auth_failure_redirect"})}async get(e,t){return(await this.client.get(e,t)).data}async post(e,t,r){return(await this.client.post(e,t,r)).data}async put(e,t,r){return(await this.client.put(e,t,r)).data}async patch(e,t,r){return(await this.client.patch(e,t,r)).data}async delete(e,t){return(await this.client.delete(e,t)).data}async uploadFile(e,t,r,s){let o=new FormData;return o.append("file",t),(await this.client.post(e,o,{...s,headers:{"Content-Type":"multipart/form-data",...null==s?void 0:s.headers},onUploadProgress:r})).data}async healthCheck(){try{return await this.get("/health"),o.Rm.info("Health check passed",{action:"health_check_success"}),!0}catch(e){return o.Rm.error("Health check failed",e,{action:"health_check_failed"}),!1}}constructor(e={}){this.isRefreshing=!1,this.failedQueue=[],this.requestInterceptor=e=>{var t,r;let s=this.generateRequestId();e.headers=e.headers||{},e.headers["X-Request-ID"]=s,e.headers["X-Request-Timestamp"]=new Date().toISOString();let i=this.isPublicRoute(e.url),n=this.isRefreshUrl(e.url);if(!i){let t=this.getAccessToken();t&&(e.headers.Authorization="Bearer ".concat(t))}if(n){let t=this.getRefreshToken();t&&(e.headers["X-Refresh-Token"]=t)}let a=this.getCsrfToken();a&&(e.headers["X-CSRF-Token"]=a);let u={...e.headers};u.Authorization&&(u.Authorization="Bearer ***"),u["X-Refresh-Token"]&&(u["X-Refresh-Token"]="***");let c=e.data;return(null===(t=e.url)||void 0===t?void 0:t.includes("/auth/login"))&&e.data&&(c={email:"***",password:"***"}),o.Rm.api.request((null===(r=e.method)||void 0===r?void 0:r.toUpperCase())||"UNKNOWN",e.url||"unknown",s,{headers:u,data:c}),e},this.requestErrorInterceptor=e=>(o.Rm.error("API Request Error",e,{action:"api_request_error"}),Promise.reject(e)),this.responseInterceptor=e=>e,this.responseErrorInterceptor=async e=>{var t;let r=e.config;if(!e.response){let t=new u("Network error occurred. Please check your internet connection.","NETWORK_ERROR",void 0,{originalError:e.message});throw o.Rm.error("Network Error",t,{action:"network_error"}),t}let{status:s,data:i}=e.response,n=null==r?void 0:null===(t=r.headers)||void 0===t?void 0:t["X-Request-ID"];if((401===s||403===s)&&r&&!r._retry&&!this.isRefreshUrl(r.url)){r._retry=!0;try{let e=await this.refreshAuthToken();if(e)return r.headers=r.headers||{},r.headers.Authorization="Bearer ".concat(e),this.client.request(r)}catch(r){this.handleAuthFailure();let t=new u("Authentication failed. Please log in again.","AUTH_FAILED",s,{originalError:e.message},n);throw o.Rm.error("Authentication Failed",t,{action:"auth_failed",requestId:n,status:s}),t}}if(this.shouldRetry(s)&&this.canRetry(r))return this.retryRequest(r);let a=this.parseErrorResponse(i,s,n);throw o.Rm.api.error(s,(null==r?void 0:r.url)||"unknown",n||"unknown",a,i),a};let t=n();this.defaultConfig={timeout:t.timeout,retries:t.retries,retryDelay:t.retryDelay,...e},this.client=s.A.create({baseURL:t.baseURL,timeout:this.defaultConfig.timeout,headers:{"Content-Type":"application/json",Accept:"application/json","X-Client-Version":i.env.NEXT_PUBLIC_APP_VERSION||"1.0.0","X-Client-Platform":"web","X-Requested-With":"XMLHttpRequest",...this.defaultConfig.headers},withCredentials:!0}),this.setupInterceptors()}}let l=new c}}]);