"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[525],{35525:(e,t,r)=>{r.d(t,{authService:()=>i});var o=r(92844),n=r(20395);class a{static getInstance(){return a.instance||(a.instance=new a),a.instance}endPoints(){return{LOGIN:"/auth/login",LOGOUT:"/auth/logout",REFRESH_TOKEN:"/auth/token/refresh"}}async login(e){try{var t;let{data:r,status:a,message:s}=await o.uE.post(this.endPoints().LOGIN,e);if(!a)throw Error(s||"Login failed");return n.Rm.info("Login successful",{userId:null===(t=r.user)||void 0===t?void 0:t.id,action:"login_success"}),this.setAuthUser(r.user),this.setAccessTokenFallback(r.accessToken),this.setRefreshTokenFallback(r.refreshToken),r}catch(e){if(n.Rm.error("Login service error",e,{action:"login_error"}),e instanceof Error)throw e;throw Error("Network error occurred")}}async logout(){try{let e=this.getAuthUser(),t=await o.uE.post(this.endPoints().LOGOUT);return n.Rm.auth("User logout successful",null==e?void 0:e.id),t.data}catch(e){n.Rm.error("Logout error",e,{action:"logout_error"})}finally{this.clearAuthData()}}async refreshToken(e){let{token:t}=e;try{var r;if(!t)throw Error("Token is required");let e=null===(r=this.getAuthUser())||void 0===r?void 0:r.id;if(!e)throw Error("User ID is required");let{data:{token:a,status:s}}=await o.uE.post(this.endPoints().REFRESH_TOKEN);if(!s)throw Error("Authentication error, login again");this.setAccessTokenFallback(a),n.Rm.auth("Token refresh successful",e)}catch(e){if(n.Rm.error("Refresh token error",e,{action:"token_refresh_error"}),e instanceof Error)throw e;throw Error("Network error occurred")}}setRefreshTokenFallback(e){if(!s()){n.Rm.warn("Client-side token storage should not be used in production",{action:"security_warning"});return}try{if(!e)throw Error("Token is required");{let t="https:"===window.location.protocol;document.cookie="refresh_token=".concat(e,"; path=/; max-age=604800; ").concat(t?"secure; ":"","samesite=").concat(t?"strict":"lax")}}catch(e){throw Error(e)}}setAccessTokenFallback(e){if(!s()){n.Rm.warn("Client-side token storage should not be used in production",{action:"security_warning"});return}try{if(!e)throw Error("Token is required");{let t="https:"===window.location.protocol;document.cookie="access_token=".concat(e,"; path=/; max-age=3600; ").concat(t?"secure; ":"","samesite=").concat(t?"strict":"lax")}}catch(e){throw Error(e)}}setAuthUser(e){{let t={id:e.id,firstName:e.firstName,lastName:e.lastName,email:e.email,roleId:e.roleId,userType:e.userType,profile:null==e?void 0:e.profile,school:null==e?void 0:e.school,assignedClasses:null==e?void 0:e.assignedClasses,assignedSubjects:null==e?void 0:e.assignedSubjects};localStorage.setItem("user",JSON.stringify(t))}}getAuthUser(){try{let e=localStorage.getItem("user");return e?JSON.parse(e):null}catch(e){n.Rm.error("Error parsing user data",e,{action:"user_data_parse_error"}),localStorage.removeItem("user")}return null}clearAuthData(){{localStorage.removeItem("user");let e="https:"===window.location.protocol,t=e?"secure; ":"",r=e?"strict":"lax";document.cookie="access_token=; path=/; max-age=0; ".concat(t,"samesite=").concat(r),document.cookie="refresh_token=; path=/; max-age=0; ".concat(t,"samesite=").concat(r),n.Rm.info("Auth data cleared",{action:"auth_data_clear"})}}getStoredToken(){var e;return s()&&(null===(e=document.cookie.split("; ").find(e=>e.startsWith("access_token=")))||void 0===e?void 0:e.split("=")[1])||null}isTokenExpired(e){try{if(!e||"string"!=typeof e)return!0;let t=e.split(".");if(3!==t.length)return!0;let r=JSON.parse(atob(t[1])),o=Math.floor(Date.now()/1e3);if(!r.exp||"number"!=typeof r.exp)return!0;return r.exp<o+300}catch(e){return s()&&n.Rm.error("Token validation error",e,{action:"token_validation_error"}),!0}}getTokenExpiration(e){try{if(!e||"string"!=typeof e)return null;let t=e.split(".");if(3!==t.length)return null;let r=JSON.parse(atob(t[1]));if(!r.exp||"number"!=typeof r.exp)return null;return new Date(1e3*r.exp)}catch(e){return s()&&n.Rm.error("Error getting token expiration",e,{action:"token_expiration_error"}),null}}isValidTokenFormat(e){try{if(!e||"string"!=typeof e)return!1;let t=e.split(".");if(3!==t.length)return!1;let r=JSON.parse(atob(t[0])),o=JSON.parse(atob(t[1]));return r.alg&&o.exp&&o.iat}catch(e){return!1}}constructor(){}}function s(){return"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname||window.location.hostname.includes("localhost")||window.location.hostname.includes("192.168.2.43")}let i=a.getInstance()}}]);