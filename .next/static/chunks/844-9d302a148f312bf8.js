"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[844],{20395:(e,t,r)=>{r.d(t,{Rm:()=>i});var o=function(e){return e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR",e[e.FATAL=4]="FATAL",e}({});class s{static getInstance(){return s.instance||(s.instance=new s),s.instance}shouldLog(e){return e>=this.logLevel}formatMessage(e,t,r,o,s){let n={timestamp:new Date().toISOString(),level:e,message:t,context:r,error:o,data:s};return o&&(n.error={name:o.name,message:o.message,stack:this.isDevelopment?o.stack:void 0}),n}outputLog(e){if(!this.shouldLog(e.level))return;let{timestamp:t,level:r,message:s,context:n,error:i,data:a}=e,u=o[r],c="[".concat(t,"] [").concat(u,"]");if(this.isDevelopment){this.getConsoleMethod(r)(c,s,{context:n,error:i,data:a});return}this.isProduction&&this.getConsoleMethod(r)(JSON.stringify(e))}getConsoleMethod(e){switch(e){case 0:return console.debug;case 1:return console.info;case 2:return console.warn;case 3:case 4:return console.error;default:return console.log}}debug(e,t,r){this.outputLog(this.formatMessage(0,e,t,void 0,r))}info(e,t,r){this.outputLog(this.formatMessage(1,e,t,void 0,r))}warn(e,t,r){this.outputLog(this.formatMessage(2,e,t,void 0,r))}error(e,t,r,o){this.outputLog(this.formatMessage(3,e,r,t,o))}fatal(e,t,r,o){this.outputLog(this.formatMessage(4,e,r,t,o))}logApiRequest(e,t,r,o){this.info("API Request: ".concat(e," ").concat(t),{requestId:r,action:"api_request"},o)}logApiResponse(e,t,r,o){this.info("API Response: ".concat(e," ").concat(t),{requestId:r,action:"api_response"},o)}logApiError(e,t,r,o,s){this.error("API Error: ".concat(e," ").concat(t),o,{requestId:r,action:"api_error"},s)}logAuthEvent(e,t,r){this.info("Auth Event: ".concat(e),{userId:t,action:"auth_event"},r)}logUserAction(e,t,r){this.info("User Action: ".concat(e),{userId:t,action:"user_action"},r)}logSecurityEvent(e,t,r){this.warn("Security Event: ".concat(e),{userId:t,action:"security_event"},r)}logPerformance(e,t,r){this.info("Performance: ".concat(e," took ").concat(t,"ms"),r,{duration:t,operation:e})}logErrorBoundary(e,t,r){this.error("React Error Boundary caught error",e,r,{errorInfo:t})}setLogLevel(e){this.logLevel=e}getLogLevel(){return this.logLevel}isLevelEnabled(e){return this.shouldLog(e)}constructor(){this.isDevelopment=!1,this.isProduction=!0;let e="INFO";e?this.logLevel=o[e.toUpperCase()]||1:this.logLevel=+!this.isDevelopment}}let n=s.getInstance(),i={debug:(e,t,r)=>n.debug(e,t,r),info:(e,t,r)=>n.info(e,t,r),warn:(e,t,r)=>n.warn(e,t,r),error:(e,t,r,o)=>n.error(e,t,r,o),fatal:(e,t,r,o)=>n.fatal(e,t,r,o),api:{request:(e,t,r,o)=>n.logApiRequest(e,t,r,o),response:(e,t,r,o)=>n.logApiResponse(e,t,r,o),error:(e,t,r,o,s)=>n.logApiError(e,t,r,o,s)},auth:(e,t,r)=>n.logAuthEvent(e,t,r),user:(e,t,r)=>n.logUserAction(e,t,r),security:(e,t,r)=>n.logSecurityEvent(e,t,r),performance:(e,t,r)=>n.logPerformance(e,t,r),errorBoundary:(e,t,r)=>n.logErrorBoundary(e,t,r)}},92844:(e,t,r)=>{r.d(t,{uE:()=>c});var o=r(23464),s=r(20395),n=r(49509);let i=()=>{let e="http://192.168.2.43:8000/api/v2";if(!e)throw Error("NEXT_PUBLIC_API_BASE_URL environment variable is required");return{baseURL:e,timeout:parseInt("30000"),retries:parseInt("3"),retryDelay:parseInt("1000")}};window.location.hostname;class a extends Error{constructor(e,t,r,o,s){super(e),this.name="ApiClientError",this.code=t,this.status=r,this.details=o,this.requestId=s}}class u{setupInterceptors(){this.client.interceptors.request.use(this.requestInterceptor,this.requestErrorInterceptor),this.client.interceptors.response.use(this.responseInterceptor,this.responseErrorInterceptor)}shouldRetry(e){return e>=500||429===e}canRetry(e){return!!e&&(e._retryCount||0)<(this.defaultConfig.retries||0)}async retryRequest(e){var t;e._retry=!0,e._retryCount=(e._retryCount||0)+1;let r=(this.defaultConfig.retryDelay||1e3)*Math.pow(2,e._retryCount-1);return s.Rm.info("Retrying request (attempt ".concat(e._retryCount,")"),{requestId:null===(t=e.headers)||void 0===t?void 0:t["X-Request-ID"],delay:r,url:e.url}),await this.sleep(r),this.client.request(e)}parseErrorResponse(e,t,r){return e&&"object"==typeof e&&e.error?new a((null==e?void 0:e.message)||"An error occurred",e.error.code||"UNKNOWN_ERROR",t,e.error.details,r):new a({400:"Bad request. Please check your input.",401:"Authentication required. Please log in.",403:"Access denied. You do not have permission to perform this action.",404:"The requested resource was not found.",409:"Conflict. The resource already exists or is in use.",422:"Validation error. Please check your input.",429:"Too many requests. Please try again later.",500:"Internal server error. Please try again later.",502:"Bad gateway. The server is temporarily unavailable.",503:"Service unavailable. Please try again later.",504:"Gateway timeout. The request took too long to process."}[t]||"An unexpected error occurred","HTTP_".concat(t),t,{originalData:e},r)}generateRequestId(){return"req_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))}sleep(e){return new Promise(t=>setTimeout(t,e))}getCsrfToken(){var e;let t=document.querySelector('meta[name="csrf-token"]');return t?t.getAttribute("content"):(null===(e=document.cookie.split("; ").find(e=>e.startsWith("csrf-token=")))||void 0===e?void 0:e.split("=")[1])||null}getAuthToken(){var e;return(null===(e=document.cookie.split("; ").find(e=>e.startsWith("token=")))||void 0===e?void 0:e.split("=")[1])||null}async refreshAuthToken(){if(this.isRefreshing)return new Promise((e,t)=>{this.failedQueue.push({resolve:e,reject:t})});this.isRefreshing=!0;try{let e=this.getAuthToken();if(!e)throw Error("No token to refresh");let{authService:t}=await r.e(525).then(r.bind(r,35525));await t.refreshToken({token:e});let o=this.getAuthToken();return this.failedQueue.forEach(e=>{let{resolve:t}=e;t(o)}),this.failedQueue=[],s.Rm.info("Token refreshed successfully",{action:"token_refresh_success"}),o}catch(e){throw this.failedQueue.forEach(t=>{let{reject:r}=t;r(e)}),this.failedQueue=[],s.Rm.error("Token refresh failed",e,{action:"token_refresh_failed"}),e}finally{this.isRefreshing=!1}}handleAuthFailure(){document.cookie="token=; path=/; max-age=0; secure; samesite=strict",s.Rm.warn("Authentication failed, redirecting to login",{action:"auth_failure_redirect"}),"/login"!==window.location.pathname&&(window.location.href="/login")}async get(e,t){return(await this.client.get(e,t)).data}async post(e,t,r){return(await this.client.post(e,t,r)).data}async put(e,t,r){return(await this.client.put(e,t,r)).data}async patch(e,t,r){return(await this.client.patch(e,t,r)).data}async delete(e,t){return(await this.client.delete(e,t)).data}async uploadFile(e,t,r,o){let s=new FormData;return s.append("file",t),(await this.client.post(e,s,{...o,headers:{"Content-Type":"multipart/form-data",...null==o?void 0:o.headers},onUploadProgress:r})).data}async healthCheck(){try{return await this.get("/health"),s.Rm.info("Health check passed",{action:"health_check_success"}),!0}catch(e){return s.Rm.error("Health check failed",e,{action:"health_check_failed"}),!1}}constructor(e={}){this.isRefreshing=!1,this.failedQueue=[],this.requestInterceptor=e=>{var t;let r=this.generateRequestId();e.headers=e.headers||{},e.headers["X-Request-ID"]=r,e.headers["X-Request-Timestamp"]=new Date().toISOString();let o=this.getCsrfToken();return o&&(e.headers["X-CSRF-Token"]=o),s.Rm.api.request((null===(t=e.method)||void 0===t?void 0:t.toUpperCase())||"UNKNOWN",e.url||"unknown",r,{headers:e.headers,data:e.data}),e},this.requestErrorInterceptor=e=>(s.Rm.error("API Request Error",e,{action:"api_request_error"}),Promise.reject(e)),this.responseInterceptor=e=>{var t;return s.Rm.api.response(e.status,e.config.url||"unknown",(null===(t=e.config.headers)||void 0===t?void 0:t["X-Request-ID"])||"unknown",e.data),e},this.responseErrorInterceptor=async e=>{var t;let r=e.config;if(!e.response){let t=new a("Network error occurred. Please check your internet connection.","NETWORK_ERROR",void 0,{originalError:e.message});throw s.Rm.error("Network Error",t,{action:"network_error"}),t}let{status:o,data:n}=e.response,i=null==r?void 0:null===(t=r.headers)||void 0===t?void 0:t["X-Request-ID"];if((401===o||403===o)&&r&&!r._retry){r._retry=!0;try{let e=await this.refreshAuthToken();if(e)return r.headers=r.headers||{},r.headers.Authorization="Bearer ".concat(e),this.client.request(r)}catch(r){this.handleAuthFailure();let t=new a("Authentication failed. Please log in again.","AUTH_FAILED",o,{originalError:e.message},i);throw s.Rm.error("Authentication Failed",t,{action:"auth_failed",requestId:i,status:o}),t}}if(this.shouldRetry(o)&&this.canRetry(r))return this.retryRequest(r);let u=this.parseErrorResponse(n,o,i);throw s.Rm.api.error(o,(null==r?void 0:r.url)||"unknown",i||"unknown",u,n),u};let t=i();this.defaultConfig={timeout:t.timeout,retries:t.retries,retryDelay:t.retryDelay,...e},this.client=o.A.create({baseURL:t.baseURL,timeout:this.defaultConfig.timeout,headers:{"Content-Type":"application/json",Accept:"application/json","X-Client-Version":n.env.NEXT_PUBLIC_APP_VERSION||"1.0.0","X-Client-Platform":"web","X-Requested-With":"XMLHttpRequest",...this.defaultConfig.headers},withCredentials:!0}),this.setupInterceptors()}}let c=new u}}]);