"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[525],{35525:(t,r,e)=>{e.d(r,{authService:()=>s});var o=e(92844),n=e(20395);class a{static getInstance(){return a.instance||(a.instance=new a),a.instance}endPoints(){return{LOGIN:"/auth/login",LOGOUT:"/auth/logout",REFRESH_TOKEN:"/auth/token/refresh"}}async login(t){try{let{data:r,status:e,message:n}=await o.uE.post(this.endPoints().LOGIN,t);if(!e)throw Error(n||"Login failed");return this.setAuthUser(r.user),this.setAuthTokenFallback(r.token),r}catch(t){if(n.Rm.error("Login service error",t,{action:"login_error"}),t instanceof Error)throw t;throw Error("Network error occurred")}}async logout(){try{let t=this.getAuthUser(),r=await o.uE.post(this.endPoints().LOGOUT);return n.Rm.auth("User logout successful",null==t?void 0:t.id),r.data}catch(t){n.Rm.error("Logout error",t,{action:"logout_error"})}finally{this.clearAuthData()}}async refreshToken(t){let{token:r}=t;try{var e;if(!r)throw Error("Token is required");let t=null===(e=this.getAuthUser())||void 0===e?void 0:e.id;if(!t)throw Error("User ID is required");let{data:{token:a,status:i}}=await o.uE.post(this.endPoints().REFRESH_TOKEN,{token:r,userId:t});if(!i)throw Error("Authentication error, login again");this.setAuthTokenFallback(a),n.Rm.auth("Token refresh successful",t)}catch(t){if(n.Rm.error("Refresh token error",t,{action:"token_refresh_error"}),t instanceof Error)throw t;throw Error("Network error occurred")}}setAuthTokenFallback(t){if(!i()){n.Rm.warn("Client-side token storage should not be used in production",{action:"security_warning"});return}try{if(!t)throw Error("Token is required");{let r="https:"===window.location.protocol;document.cookie="token=".concat(t,"; path=/; max-age=3600; ").concat(r?"secure; ":"","samesite=").concat(r?"strict":"lax")}}catch(t){throw Error(t)}}setAuthUser(t){{let r={id:t.id,firstName:t.firstName,lastName:t.lastName,email:t.email,roleId:t.roleId,userType:t.userType,profile:null==t?void 0:t.profile,school:null==t?void 0:t.school};localStorage.setItem("user",JSON.stringify(r))}}getAuthUser(){try{let t=localStorage.getItem("user");return t?JSON.parse(t):null}catch(t){n.Rm.error("Error parsing user data",t,{action:"user_data_parse_error"}),localStorage.removeItem("user")}return null}clearAuthData(){{localStorage.removeItem("user");let t="https:"===window.location.protocol;document.cookie="token=; path=/; max-age=0; ".concat(t?"secure; ":"","samesite=").concat(t?"strict":"lax"),n.Rm.info("Auth data cleared",{action:"auth_data_clear"})}}getStoredToken(){var t;return i()&&(null===(t=document.cookie.split("; ").find(t=>t.startsWith("token=")))||void 0===t?void 0:t.split("=")[1])||null}isTokenExpired(t){try{if(!t||"string"!=typeof t)return!0;let r=t.split(".");if(3!==r.length)return!0;let e=JSON.parse(atob(r[1])),o=Math.floor(Date.now()/1e3);if(!e.exp||"number"!=typeof e.exp)return!0;return e.exp<o+300}catch(t){return i()&&n.Rm.error("Token validation error",t,{action:"token_validation_error"}),!0}}getTokenExpiration(t){try{if(!t||"string"!=typeof t)return null;let r=t.split(".");if(3!==r.length)return null;let e=JSON.parse(atob(r[1]));if(!e.exp||"number"!=typeof e.exp)return null;return new Date(1e3*e.exp)}catch(t){return i()&&n.Rm.error("Error getting token expiration",t,{action:"token_expiration_error"}),null}}isValidTokenFormat(t){try{if(!t||"string"!=typeof t)return!1;let r=t.split(".");if(3!==r.length)return!1;let e=JSON.parse(atob(r[0])),o=JSON.parse(atob(r[1]));return e.alg&&o.exp&&o.iat}catch(t){return!1}}constructor(){}}function i(){return"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname||window.location.hostname.includes("localhost")}let s=a.getInstance()}}]);