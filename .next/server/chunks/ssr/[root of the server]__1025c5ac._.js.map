{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["file:///Users/test/Documents/Projects/flexdesk/hooks/use-toast.ts"],"sourcesContent":["\"use client\"\n\n// Inspired by react-hot-toast library\nimport * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 171, "column": 0}, "map": {"version":3,"sources":["file:///Users/test/Documents/Projects/flexdesk/lib/utils.ts"],"sourcesContent":["import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n"],"names":[],"mappings":";;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,CAAA,GAAA,2JAAA,CAAA,UAAO,AAAD,EAAE,CAAA,GAAA,qIAAA,CAAA,OAAI,AAAD,EAAE;AACtB","debugId":null}},
    {"offset": {"line": 187, "column": 0}, "map": {"version":3,"sources":["file:///Users/test/Documents/Projects/flexdesk/components/ui/toast.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive border-destructive bg-destructive text-destructive-foreground text-white\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n"],"names":[],"mappings":";;;;;;;;;;AAEA;AACA;AACA;AACA;AAEA;AAPA;;;;;;;AASA,MAAM,gBAAgB,iKAAA,CAAA,WAAwB;AAE9C,MAAM,8BAAgB,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGnC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,iKAAA,CAAA,WAAwB;QACvB,KAAK;QACL,WAAW,CAAA,GAAA,4GAAA,CAAA,KAAE,AAAD,EACV,qIACA;QAED,GAAG,KAAK;;;;;;AAGb,cAAc,WAAW,GAAG,iKAAA,CAAA,WAAwB,CAAC,WAAW;AAEhE,MAAM,gBAAgB,CAAA,GAAA,gKAAA,CAAA,MAAG,AAAD,EACtB,6lBACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;QACJ;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAGF,MAAM,sBAAQ,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAI3B,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,OAAO,EAAE;IACnC,qBACE,8OAAC,iKAAA,CAAA,OAAoB;QACnB,KAAK;QACL,WAAW,CAAA,GAAA,4GAAA,CAAA,KAAE,AAAD,EAAE,cAAc;YAAE;QAAQ,IAAI;QACzC,GAAG,KAAK;;;;;;AAGf;AACA,MAAM,WAAW,GAAG,iKAAA,CAAA,OAAoB,CAAC,WAAW;AAEpD,MAAM,4BAAc,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,iKAAA,CAAA,SAAsB;QACrB,KAAK;QACL,WAAW,CAAA,GAAA,4GAAA,CAAA,KAAE,AAAD,EACV,sgBACA;QAED,GAAG,KAAK;;;;;;AAGb,YAAY,WAAW,GAAG,iKAAA,CAAA,SAAsB,CAAC,WAAW;AAE5D,MAAM,2BAAa,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,iKAAA,CAAA,QAAqB;QACpB,KAAK;QACL,WAAW,CAAA,GAAA,4GAAA,CAAA,KAAE,AAAD,EACV,yVACA;QAEF,eAAY;QACX,GAAG,KAAK;kBAET,cAAA,8OAAC,4LAAA,CAAA,IAAC;YAAC,WAAU;;;;;;;;;;;AAGjB,WAAW,WAAW,GAAG,iKAAA,CAAA,QAAqB,CAAC,WAAW;AAE1D,MAAM,2BAAa,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,iKAAA,CAAA,QAAqB;QACpB,KAAK;QACL,WAAW,CAAA,GAAA,4GAAA,CAAA,KAAE,AAAD,EAAE,yBAAyB;QACtC,GAAG,KAAK;;;;;;AAGb,WAAW,WAAW,GAAG,iKAAA,CAAA,QAAqB,CAAC,WAAW;AAE1D,MAAM,iCAAmB,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGtC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,iKAAA,CAAA,cAA2B;QAC1B,KAAK;QACL,WAAW,CAAA,GAAA,4GAAA,CAAA,KAAE,AAAD,EAAE,sBAAsB;QACnC,GAAG,KAAK;;;;;;AAGb,iBAAiB,WAAW,GAAG,iKAAA,CAAA,cAA2B,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 300, "column": 0}, "map": {"version":3,"sources":["file:///Users/test/Documents/Projects/flexdesk/components/ui/toaster.tsx"],"sourcesContent":["\"use client\"\n\nimport { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AAHA;;;;AAYO,SAAS;IACd,MAAM,EAAE,MAAM,EAAE,GAAG,CAAA,GAAA,qHAAA,CAAA,WAAQ,AAAD;IAE1B,qBACE,8OAAC,0HAAA,CAAA,gBAAa;;YACX,OAAO,GAAG,CAAC,SAAU,EAAE,EAAE,EAAE,KAAK,EAAE,WAAW,EAAE,MAAM,EAAE,GAAG,OAAO;gBAChE,qBACE,8OAAC,0HAAA,CAAA,QAAK;oBAAW,GAAG,KAAK;;sCACvB,8OAAC;4BAAI,WAAU;;gCACZ,uBAAS,8OAAC,0HAAA,CAAA,aAAU;8CAAE;;;;;;gCACtB,6BACC,8OAAC,0HAAA,CAAA,mBAAgB;8CAAE;;;;;;;;;;;;wBAGtB;sCACD,8OAAC,0HAAA,CAAA,aAAU;;;;;;mBARD;;;;;YAWhB;0BACA,8OAAC,0HAAA,CAAA,gBAAa;;;;;;;;;;;AAGpB","debugId":null}},
    {"offset": {"line": 484, "column": 0}, "map": {"version":3,"sources":["file:///Users/test/Documents/Projects/flexdesk/lib/services/logger.ts"],"sourcesContent":["\nexport enum LogLevel {\n  DEBUG = 0,\n  INFO = 1,\n  WARN = 2,\n  ERROR = 3,\n  FATAL = 4\n}\n\nexport interface LogContext {\n  userId?: string\n  requestId?: string\n  component?: string\n  action?: string\n  [key: string]: any\n}\n\nexport interface LogEntry {\n  timestamp: string\n  level: LogLevel\n  message: string\n  context?: LogContext\n  error?: Error\n  data?: any\n}\n\nclass Logger {\n  private static instance: Logger\n  private logLevel: LogLevel\n  private isDevelopment: boolean\n  private isProduction: boolean\n\n  private constructor() {\n    this.isDevelopment = process.env.NODE_ENV === 'development'\n    this.isProduction = process.env.NODE_ENV === 'production'\n    \n    const envLogLevel = process.env.NEXT_PUBLIC_LOG_LEVEL\n    if (envLogLevel) {\n      this.logLevel = LogLevel[envLogLevel.toUpperCase() as keyof typeof LogLevel] || LogLevel.INFO\n    } else {\n      this.logLevel = this.isDevelopment ? LogLevel.DEBUG : LogLevel.INFO\n    }\n  }\n\n  public static getInstance(): Logger {\n    if (!Logger.instance) {\n      Logger.instance = new Logger()\n    }\n    return Logger.instance\n  }\n\n  private shouldLog(level: LogLevel): boolean {\n    return level >= this.logLevel\n  }\n\n  private formatMessage(level: LogLevel, message: string, context?: LogContext, error?: Error, data?: any): LogEntry {\n    const entry: LogEntry = {\n      timestamp: new Date().toISOString(),\n      level,\n      message,\n      context,\n      error,\n      data\n    }\n\n    if (error) {\n      entry.error = {\n        name: error.name,\n        message: error.message,\n        stack: this.isDevelopment ? error.stack : undefined\n      }\n    }\n\n    return entry\n  }\n\n  private outputLog(entry: LogEntry): void {\n    if (!this.shouldLog(entry.level)) return\n\n    const { timestamp, level, message, context, error, data } = entry\n    const levelName = LogLevel[level]\n    const prefix = `[${timestamp}] [${levelName}]`\n\n    if (this.isDevelopment) {\n      const consoleMethod = this.getConsoleMethod(level)\n      consoleMethod(prefix, message, { context, error, data })\n      return\n    }\n\n    if (this.isProduction) {\n      const consoleMethod = this.getConsoleMethod(level)\n      consoleMethod(JSON.stringify(entry))\n      // TODO: Send to external logging service (e.g., Sentry, LogRocket, etc.)\n      // this.sendToExternalService(entry)\n    }\n  }\n\n  private getConsoleMethod(level: LogLevel): (...args: any[]) => void {\n    switch (level) {\n      case LogLevel.DEBUG:\n        return console.debug\n      case LogLevel.INFO:\n        return console.info\n      case LogLevel.WARN:\n        return console.warn\n      case LogLevel.ERROR:\n      case LogLevel.FATAL:\n        return console.error\n      default:\n        return console.log\n    }\n  }\n\n  // Public logging methods\n  public debug(message: string, context?: LogContext, data?: any): void {\n    this.outputLog(this.formatMessage(LogLevel.DEBUG, message, context, undefined, data))\n  }\n\n  public info(message: string, context?: LogContext, data?: any): void {\n    this.outputLog(this.formatMessage(LogLevel.INFO, message, context, undefined, data))\n  }\n\n  public warn(message: string, context?: LogContext, data?: any): void {\n    this.outputLog(this.formatMessage(LogLevel.WARN, message, context, undefined, data))\n  }\n\n  public error(message: string, error?: Error, context?: LogContext, data?: any): void {\n    this.outputLog(this.formatMessage(LogLevel.ERROR, message, context, error, data))\n  }\n\n  public fatal(message: string, error?: Error, context?: LogContext, data?: any): void {\n    this.outputLog(this.formatMessage(LogLevel.FATAL, message, context, error, data))\n  }\n\n  // Convenience methods for common logging patterns\n  public logApiRequest(method: string, url: string, requestId: string, data?: any): void {\n    this.info(`API Request: ${method} ${url}`, { requestId, action: 'api_request' }, data)\n  }\n\n  public logApiResponse(status: number, url: string, requestId: string, data?: any): void {\n    this.info(`API Response: ${status} ${url}`, { requestId, action: 'api_response' }, data)\n  }\n\n  public logApiError(status: number, url: string, requestId: string, error: Error, data?: any): void {\n    this.error(`API Error: ${status} ${url}`, error, { requestId, action: 'api_error' }, data)\n  }\n\n  public logAuthEvent(event: string, userId?: string, data?: any): void {\n    this.info(`Auth Event: ${event}`, { userId, action: 'auth_event' }, data)\n  }\n\n  public logUserAction(action: string, userId?: string, data?: any): void {\n    this.info(`User Action: ${action}`, { userId, action: 'user_action' }, data)\n  }\n\n  public logSecurityEvent(event: string, userId?: string, data?: any): void {\n    this.warn(`Security Event: ${event}`, { userId, action: 'security_event' }, data)\n  }\n\n  // Performance logging\n  public logPerformance(operation: string, duration: number, context?: LogContext): void {\n    this.info(`Performance: ${operation} took ${duration}ms`, context, { duration, operation })\n  }\n\n  // Error boundary logging\n  public logErrorBoundary(error: Error, errorInfo: any, context?: LogContext): void {\n    this.error('React Error Boundary caught error', error, context, { errorInfo })\n  }\n\n  // Set log level dynamically\n  public setLogLevel(level: LogLevel): void {\n    this.logLevel = level\n  }\n\n  // Get current log level\n  public getLogLevel(): LogLevel {\n    return this.logLevel\n  }\n\n  // Check if a level is enabled\n  public isLevelEnabled(level: LogLevel): boolean {\n    return this.shouldLog(level)\n  }\n}\n\n// Export singleton instance\nexport const logger = Logger.getInstance()\n\n// Export convenience functions for direct use\nexport const log = {\n  debug: (message: string, context?: LogContext, data?: any) => logger.debug(message, context, data),\n  info: (message: string, context?: LogContext, data?: any) => logger.info(message, context, data),\n  warn: (message: string, context?: LogContext, data?: any) => logger.warn(message, context, data),\n  error: (message: string, error?: Error, context?: LogContext, data?: any) => logger.error(message, error, context, data),\n  fatal: (message: string, error?: Error, context?: LogContext, data?: any) => logger.fatal(message, error, context, data),\n  \n  // Convenience methods\n  api: {\n    request: (method: string, url: string, requestId: string, data?: any) => logger.logApiRequest(method, url, requestId, data),\n    response: (status: number, url: string, requestId: string, data?: any) => logger.logApiResponse(status, url, requestId, data),\n    error: (status: number, url: string, requestId: string, error: Error, data?: any) => logger.logApiError(status, url, requestId, error, data),\n  },\n  \n  auth: (event: string, userId?: string, data?: any) => logger.logAuthEvent(event, userId, data),\n  user: (action: string, userId?: string, data?: any) => logger.logUserAction(action, userId, data),\n  security: (event: string, userId?: string, data?: any) => logger.logSecurityEvent(event, userId, data),\n  performance: (operation: string, duration: number, context?: LogContext) => logger.logPerformance(operation, duration, context),\n  errorBoundary: (error: Error, errorInfo: any, context?: LogContext) => logger.logErrorBoundary(error, errorInfo, context),\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 679, "column": 0}, "map": {"version":3,"sources":["file:///Users/test/Documents/Projects/flexdesk/lib/api/client.ts"],"sourcesContent":["import axios, {\n  type AxiosInstance,\n  type AxiosRequestConfig,\n  type AxiosResponse,\n  type AxiosError,\n  type InternalAxiosRequestConfig,\n} from \"axios\"\nimport type { ApiResponse, RequestConfig } from \"@/lib/types/api\"\nimport { log } from \"@/lib/services/logger\"\n\n// Environment configuration with validation\nconst getApiConfig = () => {\n  const baseURL = process.env.NEXT_PUBLIC_API_BASE_URL\n  if (!baseURL) {\n    throw new Error(\"NEXT_PUBLIC_API_BASE_URL environment variable is required\")\n  }\n  \n  return {\n    baseURL,\n    timeout: parseInt(process.env.NEXT_PUBLIC_API_TIMEOUT || \"30000\"),\n    retries: parseInt(process.env.NEXT_PUBLIC_API_RETRIES || \"3\"),\n    retryDelay: parseInt(process.env.NEXT_PUBLIC_API_RETRY_DELAY || \"1000\"),\n  } as const\n}\n\n// Refresh endpoint path (joined with baseURL by axios)\nconst REFRESH_ENDPOINT_PATH = \"/auth/token/refresh\"\n\n// Custom error class for API errors\nexport class ApiClientError extends Error {\n  public readonly code: string\n  public readonly status?: number\n  public readonly details?: Record<string, any>\n  public readonly requestId?: string\n\n  constructor(message: string, code: string, status?: number, details?: Record<string, any>, requestId?: string) {\n    super(message)\n    this.name = \"ApiClientError\"\n    this.code = code\n    this.status = status\n    this.details = details\n    this.requestId = requestId\n  }\n}\n\n// Request/Response interceptor types\ntype RequestInterceptor = (\n  config: InternalAxiosRequestConfig,\n) => InternalAxiosRequestConfig | Promise<InternalAxiosRequestConfig>\ntype ResponseInterceptor = (response: AxiosResponse) => AxiosResponse | Promise<AxiosResponse>\ntype ErrorInterceptor = (error: AxiosError) => Promise<never> | Promise<AxiosResponse>\n\nclass ApiClient {\n  private readonly client: AxiosInstance\n  private readonly defaultConfig: RequestConfig\n  private isRefreshing = false\n  private failedQueue: Array<{\n    resolve: (value: string | null) => void\n    reject: (reason: any) => void\n  }> = []\n\n  constructor(config: RequestConfig = {}) {\n    const apiConfig = getApiConfig()\n    \n    this.defaultConfig = {\n      timeout: apiConfig.timeout,\n      retries: apiConfig.retries,\n      retryDelay: apiConfig.retryDelay,\n      ...config,\n    }\n\n    this.client = axios.create({\n      baseURL: apiConfig.baseURL,\n      timeout: this.defaultConfig.timeout,\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Accept: \"application/json\",\n        \"X-Client-Version\": process.env.NEXT_PUBLIC_APP_VERSION || \"1.0.0\",\n        \"X-Client-Platform\": \"web\",\n        \"X-Requested-With\": \"XMLHttpRequest\", // CSRF protection\n        ...this.defaultConfig.headers,\n      },\n      withCredentials: true, // Enable cookies for CSRF protection\n    })\n\n    this.setupInterceptors()\n  }\n\n  private setupInterceptors(): void {\n    // Request interceptor\n    this.client.interceptors.request.use(this.requestInterceptor, this.requestErrorInterceptor)\n\n    // Response interceptor\n    this.client.interceptors.response.use(this.responseInterceptor, this.responseErrorInterceptor)\n  }\n\n  private requestInterceptor: RequestInterceptor = (config) => {\n    // Add request ID for tracing\n    const requestId = this.generateRequestId()\n    config.headers = config.headers || {}\n    config.headers[\"X-Request-ID\"] = requestId\n\n    // Add timestamp\n    config.headers[\"X-Request-Timestamp\"] = new Date().toISOString()\n\n    // Determine if this is a public route that doesn't need authentication\n    const isPublicRoute = this.isPublicRoute(config.url)\n    const isRefreshRequest = this.isRefreshUrl(config.url)\n\n    // Only attach access token for authenticated routes\n    if (!isPublicRoute) {\n      const accessToken = this.getAccessToken()\n      if (accessToken) {\n        config.headers.Authorization = `Bearer ${accessToken}`\n      }\n    }\n\n    // For refresh requests, also attach refresh token in X-Refresh-Token header\n    if (isRefreshRequest) {\n      const refreshToken = this.getRefreshToken()\n      if (refreshToken) {\n        config.headers[\"X-Refresh-Token\"] = refreshToken\n      }\n    }\n\n    // Add CSRF token if available\n    const csrfToken = this.getCsrfToken()\n    if (csrfToken) {\n      config.headers[\"X-CSRF-Token\"] = csrfToken\n    }\n\n    // Log request using structured logging (sanitize sensitive data)\n    const sanitizedHeaders = { ...config.headers }\n    if (sanitizedHeaders.Authorization) {\n      sanitizedHeaders.Authorization = 'Bearer ***'\n    }\n    if (sanitizedHeaders['X-Refresh-Token']) {\n      sanitizedHeaders['X-Refresh-Token'] = '***'\n    }\n\n    // Sanitize request data for logging (especially for login requests)\n    let sanitizedData = config.data\n    if (config.url?.includes('/auth/login') && config.data) {\n      sanitizedData = { email: '***', password: '***' }\n    }\n\n    log.api.request(\n      config.method?.toUpperCase() || 'UNKNOWN',\n      config.url || 'unknown',\n      requestId,\n      {\n        headers: sanitizedHeaders,\n        data: sanitizedData,\n      }\n    )\n\n    return config\n  }\n\n  private requestErrorInterceptor = (error: AxiosError): Promise<never> => {\n    log.error('API Request Error', error, { action: 'api_request_error' })\n    return Promise.reject(error)\n  }\n\n  private responseInterceptor: ResponseInterceptor = (response) => {\n    return response\n  }\n\n  private responseErrorInterceptor: ErrorInterceptor = async (error) => {\n    const originalRequest = error.config as InternalAxiosRequestConfig & { _retry?: boolean; _retryCount?: number }\n  \n    // Handle network errors\n    if (!error.response) {\n      const networkError = new ApiClientError(\n        \"Network error occurred. Please check your internet connection.\",\n        \"NETWORK_ERROR\",\n        undefined,\n        { originalError: error.message },\n      )\n      \n      log.error('Network Error', networkError, { action: 'network_error' })\n      throw networkError\n    }\n\n    const { status, data } = error.response\n    const requestId = originalRequest?.headers?.[\"X-Request-ID\"] as string\n\n    // Handle authentication errors (401/403) with token refresh\n    if (status === 401 || status === 403) {\n      if (originalRequest && !originalRequest._retry && !this.isRefreshUrl(originalRequest.url)) {\n        originalRequest._retry = true\n        \n        try {\n          // Try to refresh the token (sends both access and refresh tokens via headers)\n          const newToken = await this.refreshAuthToken()\n          if (newToken) {\n            // Update the original request with new token\n            originalRequest.headers = originalRequest.headers || {}\n            originalRequest.headers.Authorization = `Bearer ${newToken}`\n            \n            // Retry the original request\n            return this.client.request(originalRequest)\n          }\n        } catch (refreshError) {\n          // Token refresh failed, redirect to login\n          this.handleAuthFailure()\n          const authError = new ApiClientError(\n            \"Authentication failed. Please log in again.\",\n            \"AUTH_FAILED\",\n            status,\n            { originalError: error.message },\n            requestId,\n          )\n          \n          log.error('Authentication Failed', authError, { \n            action: 'auth_failed',\n            requestId,\n            status \n          })\n          throw authError\n        }\n      }\n    }\n\n    // Handle retry logic for specific status codes\n    if (this.shouldRetry(status) && this.canRetry(originalRequest)) {\n      return this.retryRequest(originalRequest)\n    }\n\n    // Parse error response\n    const apiError = this.parseErrorResponse(data, status, requestId)\n\n    // Log error using structured logging\n    log.api.error(status, originalRequest?.url || 'unknown', requestId || 'unknown', apiError, data)\n\n    throw apiError\n  }\n\n  private shouldRetry(status: number): boolean {\n    // Retry on server errors and rate limiting\n    return status >= 500 || status === 429\n  }\n\n  private canRetry(config?: InternalAxiosRequestConfig & { _retry?: boolean; _retryCount?: number }): boolean {\n    if (!config) return false\n\n    const retryCount = config._retryCount || 0\n    const maxRetries = this.defaultConfig.retries || 0\n\n    return retryCount < maxRetries\n  }\n\n  private async retryRequest(\n    config: InternalAxiosRequestConfig & { _retry?: boolean; _retryCount?: number },\n  ): Promise<AxiosResponse> {\n    config._retry = true\n    config._retryCount = (config._retryCount || 0) + 1\n\n    // Exponential backoff\n    const delay = (this.defaultConfig.retryDelay || 1000) * Math.pow(2, config._retryCount - 1)\n    \n    log.info(`Retrying request (attempt ${config._retryCount})`, {\n      requestId: config.headers?.[\"X-Request-ID\"],\n      delay,\n      url: config.url\n    })\n    \n    await this.sleep(delay)\n\n    return this.client.request(config)\n  }\n\n  private parseErrorResponse(data: any, status: number, requestId?: string): ApiClientError {\n    // Handle structured API error response\n    if (data && typeof data === \"object\" && data.error) {\n      return new ApiClientError(\n        data?.message || \"An error occurred\",\n        data.error.code || \"UNKNOWN_ERROR\",\n        status,\n        data.error.details,\n        requestId,\n      )\n    }\n\n    // Handle generic error responses\n    const errorMessages: Record<number, string> = {\n      400: \"Bad request. Please check your input.\",\n      401: \"Authentication required. Please log in.\",\n      403: \"Access denied. You do not have permission to perform this action.\",\n      404: \"The requested resource was not found.\",\n      409: \"Conflict. The resource already exists or is in use.\",\n      422: \"Validation error. Please check your input.\",\n      429: \"Too many requests. Please try again later.\",\n      500: \"Internal server error. Please try again later.\",\n      502: \"Bad gateway. The server is temporarily unavailable.\",\n      503: \"Service unavailable. Please try again later.\",\n      504: \"Gateway timeout. The request took too long to process.\",\n    }\n\n    const message = errorMessages[status] || \"An unexpected error occurred\"\n    const code = `HTTP_${status}`\n\n    return new ApiClientError(message, code, status, { originalData: data }, requestId)\n  }\n\n  private generateRequestId(): string {\n    return `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`\n  }\n\n  private sleep(ms: number): Promise<void> {\n    return new Promise((resolve) => setTimeout(resolve, ms))\n  }\n\n  // CSRF token management\n  private getCsrfToken(): string | null {\n    if (typeof window === \"undefined\") return null\n    \n    // Get CSRF token from meta tag or cookie\n    const metaTag = document.querySelector('meta[name=\"csrf-token\"]')\n    if (metaTag) {\n      return metaTag.getAttribute('content')\n    }\n    \n    // Fallback to cookie\n    const token = document.cookie\n      .split(\"; \")\n      .find(row => row.startsWith(\"csrf-token=\"))\n      ?.split(\"=\")[1]\n    \n    return token || null\n  }\n\n  // Access and refresh token helpers (client-side fallback)\n  private getAccessToken(): string | null {\n    if (typeof window === \"undefined\") return null\n    const token = document.cookie\n      .split(\"; \")\n      .find(row => row.startsWith(\"access_token=\"))\n      ?.split(\"=\")[1]\n    return token || null\n  }\n\n  private getRefreshToken(): string | null {\n    if (typeof window === \"undefined\") return null\n    const token = document.cookie\n      .split(\"; \")\n      .find(row => row.startsWith(\"refresh_token=\"))\n      ?.split(\"=\")[1]\n    return token || null\n  }\n\n  private isRefreshUrl(url?: string): boolean {\n    if (!url) return false\n    try {\n      // Axios may pass relative URLs (\"/auth/token/refresh\") or full URLs\n      return url.endsWith(REFRESH_ENDPOINT_PATH) || new URL(url, window.location.origin).pathname.endsWith(REFRESH_ENDPOINT_PATH)\n    } catch {\n      return url.endsWith(REFRESH_ENDPOINT_PATH)\n    }\n  }\n\n  private isPublicRoute(url?: string): boolean {\n    if (!url) return false\n    \n    const publicRoutes = [\n      '/auth/login',\n      '/auth/register',\n      '/auth/forgot-password',\n      '/auth/reset-password',\n      '/health',\n      '/api/health'\n    ]\n    \n    try {\n      // Check if URL matches any public route\n      const pathname = url.startsWith('http') ? new URL(url).pathname : url\n      return publicRoutes.some(route => pathname.startsWith(route))\n    } catch {\n      // Fallback to simple string matching\n      return publicRoutes.some(route => url.startsWith(route))\n    }\n  }\n\n  private async refreshAuthToken(): Promise<string | null> {\n    if (this.isRefreshing) {\n      // If already refreshing, wait for it to complete\n      return new Promise((resolve, reject) => {\n        this.failedQueue.push({ resolve, reject })\n      })\n    }\n\n    this.isRefreshing = true\n\n    try {\n      const accessToken = this.getAccessToken()\n      const refreshToken = this.getRefreshToken()\n      if (!accessToken || !refreshToken) {\n        throw new Error(\"Missing tokens for refresh\")\n      }\n\n      // Import auth service dynamically to avoid circular dependency\n      const { authService } = await import(\"@/lib/services/auth\")\n      // The interceptor will attach Authorization and X-Refresh-Token headers\n      await authService.refreshToken({ token: accessToken })\n      \n      const newAccessToken = this.getAccessToken()\n      \n      // Process queued requests\n      this.failedQueue.forEach(({ resolve }) => {\n        resolve(newAccessToken as any)\n      })\n      this.failedQueue = []\n      \n      log.info('Token refreshed successfully', { action: 'token_refresh_success' })\n      return newAccessToken\n    } catch (error) {\n      // Process queued requests with error\n      this.failedQueue.forEach(({ reject }) => {\n        reject(error)\n      })\n      this.failedQueue = []\n      \n      log.error('Token refresh failed', error as Error, { action: 'token_refresh_failed' })\n      throw error\n    } finally {\n      this.isRefreshing = false\n    }\n  }\n\n  private handleAuthFailure(): void {\n    // Clear token and redirect to login\n    if (typeof window !== \"undefined\") {\n      // Clear token cookies\n      document.cookie = \"access_token=; path=/; max-age=0; secure; samesite=strict\"\n      document.cookie = \"refresh_token=; path=/; max-age=0; secure; samesite=strict\"\n      \n      log.warn('Authentication failed, redirecting to login', { action: 'auth_failure_redirect' })\n      \n      // Redirect to login page\n      // if (window.location.pathname !== \"/login\") {\n      //   window.location.href = \"/login\"\n      // }\n    }\n  }\n\n  // Public API methods\n  public async get<T = any>(url: string, config?: AxiosRequestConfig): Promise<ApiResponse<T>> {\n    const response = await this.client.get<ApiResponse<T>>(url, config)\n    return response.data\n  }\n\n  public async post<T = any>(url: string, data?: any, config?: AxiosRequestConfig): Promise<ApiResponse<T>> {\n    const response = await this.client.post<ApiResponse<T>>(url, data, config)\n    return response.data\n  }\n\n  public async put<T = any>(url: string, data?: any, config?: AxiosRequestConfig): Promise<ApiResponse<T>> {\n    const response = await this.client.put<ApiResponse<T>>(url, data, config)\n    return response.data\n  }\n\n  public async patch<T = any>(url: string, data?: any, config?: AxiosRequestConfig): Promise<ApiResponse<T>> {\n    const response = await this.client.patch<ApiResponse<T>>(url, data, config)\n    return response.data\n  }\n\n  public async delete<T = any>(url: string, config?: AxiosRequestConfig): Promise<ApiResponse<T>> {\n    const response = await this.client.delete<ApiResponse<T>>(url, config)\n    return response.data\n  }\n\n  // File upload method\n  public async uploadFile<T = any>(\n    url: string,\n    file: File,\n    onUploadProgress?: (progressEvent: any) => void,\n    config?: AxiosRequestConfig,\n  ): Promise<ApiResponse<T>> {\n    const formData = new FormData()\n    formData.append(\"file\", file)\n\n    const response = await this.client.post<ApiResponse<T>>(url, formData, {\n      ...config,\n      headers: {\n        \"Content-Type\": \"multipart/form-data\",\n        ...config?.headers,\n      },\n      onUploadProgress,\n    })\n\n    return response.data\n  }\n\n  // Health check method\n  public async healthCheck(): Promise<boolean> {\n    try {\n      await this.get(\"/health\")\n      log.info('Health check passed', { action: 'health_check_success' })\n      return true\n    } catch (error) {\n      log.error('Health check failed', error as Error, { action: 'health_check_failed' })\n      return false\n    }\n  }\n}\n\n// Export singleton instance\nexport const apiClient = new ApiClient()\n\n// Export class for custom instances\nexport { ApiClient }\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1084, "column": 0}, "map": {"version":3,"sources":["file:///Users/test/Documents/Projects/flexdesk/lib/services/auth.ts"],"sourcesContent":["import type { LoginRequest, LoginResponse, User } from \"@/lib/types/auth\"\nimport { apiClient } from \"@/lib/api/client\"\nimport { log } from \"@/lib/services/logger\"\n\nclass AuthService {\n  private static instance: AuthService\n\n  private constructor() {}\n\n  public static getInstance(): AuthService {\n    if (!AuthService.instance) {\n      AuthService.instance = new AuthService()\n    }\n    return AuthService.instance\n  }\n\n  private endPoints() {\n    return {\n      LOGIN: \"/auth/login\",\n      LOGOUT: \"/auth/logout\",\n      REFRESH_TOKEN: \"/auth/token/refresh\",\n    }\n  }\n\n  async login(credentials: LoginRequest): Promise<LoginResponse> {\n    try {\n      const response = await apiClient.post<LoginResponse>(this.endPoints().LOGIN, credentials)\n      const { data, status, message } = response as any\n      if (!status) {\n        throw new Error(message || \"Login failed\")\n      }\n      log.info(\"Login successful\", { userId: data.user?.id, action: 'login_success' })\n      this.setAuthUser(data.user)\n      if (typeof window !== \"undefined\") {\n        this.setAccessTokenFallback(data.accessToken)\n        this.setRefreshTokenFallback(data.refreshToken)\n      }\n\n      return data\n    } catch (error) {\n      log.error(\"Login service error\", error as Error, { action: 'login_error' })\n      if (error instanceof Error) {\n        throw error\n      }\n      throw new Error(\"Network error occurred\")\n    }\n  }\n\n  async logout(): Promise<void> {\n    try {\n      const user = this.getAuthUser()\n      const response = await apiClient.post<void>(this.endPoints().LOGOUT)\n      \n      log.auth('User logout successful', user?.id)\n      return response.data\n    } catch (error) {\n      log.error(\"Logout error\", error as Error, { action: 'logout_error' })\n    } finally {\n      this.clearAuthData()\n    }\n  }\n\n  async refreshToken({ token }: { token: string }): Promise<void> {\n    try {\n      if (!token) throw new Error(\"Token is required\")\n      const userId = this.getAuthUser()?.id\n      if (!userId) throw new Error(\"User ID is required\")\n      const response = await apiClient.post<{ status: boolean, token: string }>(this.endPoints().REFRESH_TOKEN)\n      \n      const { data: { token: newToken, status } } = response\n      if (!status) throw new Error(\"Authentication error, login again\");\n      \n      if (typeof window !== \"undefined\") {\n        this.setAccessTokenFallback(newToken)\n      }\n\n      log.auth('Token refresh successful', userId)\n    } catch (error) {\n      log.error(\"Refresh token error\", error as Error, { action: 'token_refresh_error' })\n      if (error instanceof Error) {\n        throw error\n      }\n      throw new Error(\"Network error occurred\")\n    }\n  }\n\n  // Development fallback token storage - REMOVE IN PRODUCTION\n  private setRefreshTokenFallback(token: string): void {\n    if (!isDevelopment()) {\n      log.warn(\"Client-side token storage should not be used in production\", { action: 'security_warning' })\n      return\n    }\n    \n    try {\n      if (!token) throw new Error(\"Token is required\")\n      if (typeof window !== \"undefined\") {\n        const isHttps = window.location.protocol === \"https:\"\n        const secureAttr = isHttps ? \"secure; \" : \"\"\n        // Use lax in dev to avoid CSRF issues with redirects; strict in prod\n        const sameSite = isHttps ? \"strict\" : \"lax\"\n        document.cookie = `refresh_token=${token}; path=/; max-age=604800; ${secureAttr}samesite=${sameSite}`\n      }\n    } catch (error) {\n      throw new Error(error as string)\n    }\n  }\n\n  private setAccessTokenFallback(token: string): void {\n    if (!isDevelopment()) {\n      log.warn(\"Client-side token storage should not be used in production\", { action: 'security_warning' })\n      return\n    }\n\n    try {\n      if (!token) throw new Error(\"Token is required\")\n      if (typeof window !== \"undefined\") {\n        const isHttps = window.location.protocol === \"https:\"\n        const secureAttr = isHttps ? \"secure; \" : \"\"\n        const sameSite = isHttps ? \"strict\" : \"lax\"\n        document.cookie = `access_token=${token}; path=/; max-age=3600; ${secureAttr}samesite=${sameSite}`\n      }\n    } catch (error) {\n      throw new Error(error as string)\n    }\n  }\n\n  private setAuthUser(user: User): void {\n    if (typeof window !== \"undefined\") {\n      // Only store non-sensitive user data\n      const safeUserData = {\n        id: user.id,\n        firstName: user.firstName,\n        lastName: user.lastName,\n        email: user.email,\n        roleId: user.roleId,\n        userType: user.userType,\n        profile: user?.profile,\n        school: user?.school,\n        assignedClasses: user?.assignedClasses,\n        assignedSubjects: user?.assignedSubjects,\n      }\n      localStorage.setItem(\"user\", JSON.stringify(safeUserData))\n    }\n  }\n\n  public getAuthUser(): User | null {\n    if (typeof window !== \"undefined\") {\n      try {\n        const user = localStorage.getItem(\"user\")\n        return user ? JSON.parse(user) : null\n      } catch (error) {\n        log.error(\"Error parsing user data\", error as Error, { action: 'user_data_parse_error' })\n        // Clear corrupted data\n        localStorage.removeItem(\"user\")\n        return null\n      }\n    }\n    return null\n  }\n\n  public clearAuthData(): void {\n    if (typeof window !== \"undefined\") {\n      // Clear user data\n      localStorage.removeItem(\"user\")\n      \n      // Clear fallback token cookies\n      const isHttps = window.location.protocol === \"https:\"\n      const secureAttr = isHttps ? \"secure; \" : \"\"\n      const sameSite = isHttps ? \"strict\" : \"lax\"\n      document.cookie = `access_token=; path=/; max-age=0; ${secureAttr}samesite=${sameSite}`\n      document.cookie = `refresh_token=; path=/; max-age=0; ${secureAttr}samesite=${sameSite}`\n      \n      log.info('Auth data cleared', { action: 'auth_data_clear' })\n    }\n  }\n\n  getStoredToken(): string | null {\n    if (!isDevelopment()) {\n      return null\n    }\n    \n    if (typeof window === \"undefined\") return null\n    \n    const token = document.cookie\n      .split(\"; \")\n      .find(row => row.startsWith(\"access_token=\"))\n      ?.split(\"=\")[1]\n    \n    return token || null\n  }\n\n  isTokenExpired(token: string): boolean {\n    try {\n      if (!token || typeof token !== 'string') {\n        return true\n      }\n      \n      const parts = token.split('.')\n      if (parts.length !== 3) {\n        return true\n      }\n      \n      const payload = JSON.parse(atob(parts[1]))\n      const currentTime = Math.floor(Date.now() / 1000)\n      \n      // Check if token has expiration\n      if (!payload.exp || typeof payload.exp !== 'number') {\n        return true\n      }\n      \n      // Add 5 minute buffer for refresh\n      return payload.exp < (currentTime + 300)\n    } catch (error) {\n      if (isDevelopment()) {\n        log.error(\"Token validation error\", error as Error, { action: 'token_validation_error' })\n      }\n      return true // If we can't parse the token, consider it expired\n    }\n  }\n\n  // Get token expiration time with validation\n  getTokenExpiration(token: string): Date | null {\n    try {\n      if (!token || typeof token !== 'string') {\n        return null\n      }\n      \n      const parts = token.split('.')\n      if (parts.length !== 3) {\n        return null\n      }\n      \n      const payload = JSON.parse(atob(parts[1]))\n      \n      if (!payload.exp || typeof payload.exp !== 'number') {\n        return null\n      }\n      \n      return new Date(payload.exp * 1000)\n    } catch (error) {\n      if (isDevelopment()) {\n        log.error(\"Error getting token expiration\", error as Error, { action: 'token_expiration_error' })\n      }\n      return null\n    }\n  }\n\n  // Validate token structure\n  isValidTokenFormat(token: string): boolean {\n    try {\n      if (!token || typeof token !== 'string') {\n        return false\n      }\n      \n      const parts = token.split('.')\n      if (parts.length !== 3) {\n        return false\n      }\n      \n      // Basic format validation\n      const header = JSON.parse(atob(parts[0]))\n      const payload = JSON.parse(atob(parts[1]))\n      \n      return header.alg && payload.exp && payload.iat\n    } catch {\n      return false\n    }\n  }\n}\n\n// Development mode check\nfunction isDevelopment(): boolean {\n  return typeof window !== \"undefined\" && \n         (window.location.hostname === \"localhost\" || \n          window.location.hostname === \"127.0.0.1\" ||\n          window.location.hostname.includes(\"localhost\") ||\n          window.location.hostname.includes(\"192.168.2.43\")) // TODO: remove for production\n        \n}\n\nexport const authService = AuthService.getInstance()\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1289, "column": 0}, "map": {"version":3,"sources":["file:///Users/test/Documents/Projects/flexdesk/lib/types/auth.ts"],"sourcesContent":["export interface LoginRequest {\n    email: string\n    password: string\n  }\n  \n  export interface SchoolData {\n    id: string\n    name: string\n    shortName: string\n    email: string\n    phone: string\n    address: string\n    slogan: string\n    logo: string\n    website: string\n    state: string\n    lga: string\n    country: string\n    status: string\n  }\n  \n  export interface UserProfileData {\n    profilePicture: string\n    dateOfBirth: string\n    phoneNumber: string\n    address: string\n    state: string\n    lga: string\n    gender?: string\n    city?: string\n  }\n  \n  export interface AssignedClassData {\n    classId: string\n    classArmId: string\n  }\n  \n  export interface AssignedSubjectData {\n    subject: {\n      id: string\n      name: string\n      code: string\n    }\n  }\n  \n  export interface StudentData {\n    id: string\n    firstName: string\n    lastName: string\n    class: {\n      id: string\n      name: string\n      level: number\n    }\n    classArm: {\n      id: string\n      name: string\n    }\n    school: {\n      id: string\n      name: string\n      shortName: string\n    }\n  }\n  \n  export interface User {\n    id: string\n    email: string\n    firstName: string\n    lastName: string\n    otherName?: string\n    status: string\n    userType: \"staff\" | \"parent\" | \"student\" | \"bursar\" \n    schoolId: string\n    roleId: string\n    type?: \"ADMIN\" | \"CLASS_ROOM_TEACHER\" | \"SUBJECT_TEACHER\" | \"OTHER\"\n    role: string\n    school: SchoolData\n    profile: UserProfileData\n    assignedClasses: AssignedClassData[]\n    assignedSubjects: AssignedSubjectData[]\n    phone: string\n    address: string\n    state: string\n    lga: string\n    city: string\n    children?: StudentData[]\n  }\n  \n  export interface LoginResponse {\n    status: boolean\n    message: string\n    accessToken: string\n    refreshToken: string\n    userType: \"staff\" | \"parent\" | \"student\" | \"bursar\" \n    permissions: string[]\n    data: {\n      user: User\n      firstTimeLogin?: boolean\n    }\n  }\n  \n  export interface AuthContextType {\n    user: User | null\n    token: string | null\n    permissions: string[]\n    isAuthenticated: boolean\n    isLoading: boolean\n    error: string | null\n    login: (credentials: LoginRequest) => Promise<void>\n    logout: () => void\n    refreshAuth: () => Promise<void>\n  }\n  \n  export type UserRole = \"801\" | \"802\" | \"803\" | \"805\" | \"804\" | \"807\" | \"800\"\n  \n  export const ROLE_ROUTES: Record<UserRole, string> = {\n    \"801\": \"/admin/dashboard\", // Admin (can also be Super Admin)\n    \"802\": \"/superadmin/dashboard\", // Super Admin\n    \"800\": \"/superadmin/dashboard\", // Super Admin\n    \"803\": \"/teacher/dashboard\", // Teacher\n    \"805\": \"/parent/dashboard\", // Parent\n    \"804\": \"/student/dashboard\", // Student\n    \"807\": \"/bursar/dashboard\", // Bursar\n  }\n  "],"names":[],"mappings":";;;AAoHS,MAAM,cAAwC;IACnD,OAAO;IACP,OAAO;IACP,OAAO;IACP,OAAO;IACP,OAAO;IACP,OAAO;IACP,OAAO;AACT","debugId":null}},
    {"offset": {"line": 1307, "column": 0}, "map": {"version":3,"sources":["file:///Users/test/Documents/Projects/flexdesk/lib/contexts/AuthContext.tsx"],"sourcesContent":["\"use client\"\n\nimport { createContext, useContext, useEffect, useState, type ReactNode } from \"react\"\nimport { useRouter } from \"next/navigation\"\nimport { authService } from \"@/lib/services/auth\"\nimport { type AuthContextType, type LoginRequest, type User, ROLE_ROUTES } from \"@/lib/types/auth\"\nimport { toast } from \"@/hooks/use-toast\"\nimport { log } from \"@/lib/services/logger\"\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined)\n\ninterface AuthProviderProps {\n  children: ReactNode\n}\n\nexport function AuthProvider({ children }: AuthProviderProps) {\n  const [user, setUser] = useState<User | null>(null)\n  const [token, setToken] = useState<string | null>(null)\n  const [permissions, setPermissions] = useState<string[]>([])\n  const [isLoading, setIsLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n  const router = useRouter()\n\n  const isAuthenticated = !!token && !!user\n\n  useEffect(() => {\n    // Check for stored token on mount\n    const initializeAuth = async () => {\n      try {\n        const storedToken = authService.getStoredToken()\n        const newUser = authService.getAuthUser()\n        if (storedToken && newUser) {\n          if (authService.isTokenExpired(storedToken)) {\n            try {\n              await authService.refreshToken({ token: storedToken })\n              const newToken = authService.getStoredToken()\n             \n              if (newToken) {\n                setToken(newToken)\n                setUser(newUser)\n                log.auth('Auth initialized with refreshed token', newUser.id)\n              } else {\n                authService.clearAuthData()\n                log.warn('Token refresh failed during initialization', { action: 'init_token_refresh_failed' })\n              }\n            } catch (refreshError) {\n              authService.clearAuthData()\n              log.error('Token refresh failed during initialization', refreshError as Error, { action: 'init_token_refresh_error' })\n            }\n          } else {\n            setToken(storedToken)\n            setUser(newUser)\n            log.auth('Auth initialized with existing token', newUser.id)\n          }\n        }\n      } catch (error) {\n        log.error('Auth initialization error', error as Error, { action: 'auth_init_error' })\n      } finally {\n        setIsLoading(false)\n      }\n    }\n\n    initializeAuth()\n  }, [])\n\n  // Set up token refresh interval\n  useEffect(() => {\n    if (!token) return\n\n    const refreshInterval = setInterval(async () => {\n      try {\n        const currentToken = authService.getStoredToken()\n        if (currentToken && authService.isTokenExpired(currentToken)) {\n          await authService.refreshToken({ token: currentToken })\n          const newToken = authService.getStoredToken()\n          if (newToken) {\n            setToken(newToken)\n            log.info('Auto token refresh successful', { action: 'auto_token_refresh_success' })\n          }\n        }\n      } catch (error) {\n        log.error('Auto token refresh failed', error as Error, { action: 'auto_token_refresh_failed' })\n        setIsLoading(false)\n        await logout()\n      }\n    }, 5 * 60 * 1000) // Check every 5 minutes\n\n    return () => clearInterval(refreshInterval)\n  }, [token])\n\n  const login = async (credentials: LoginRequest): Promise<void> => {\n    try {\n      setIsLoading(true)\n      setError(null)\n      \n      const response = await authService.login(credentials)\n\n      console.log('This is the new login response', response);\n\n      const { user, accessToken: userToken, permissions: userPermissions } = response as any\n\n      setUser(user)\n      setToken(userToken)\n      setPermissions(userPermissions)\n\n      if (user.firstTimeLogin) {\n        router.replace(\"/onboarding\")\n      } else { \n        const roleId = user.roleId as keyof typeof ROLE_ROUTES\n        const redirectPath = ROLE_ROUTES[roleId]\n        log.user('Redirecting to role dashboard', user.id, { \n          action: 'redirect_dashboard',\n          roleId,\n          redirectPath \n        })\n        router.replace(redirectPath)\n      }\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : \"Login failed\"\n      setError(errorMessage)\n      log.error('Login failed in context', error as Error, { action: 'context_login_error' })\n      throw error\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  const logout = async (): Promise<void> => {\n    try {\n      if (token) {\n        await authService.logout()\n      }\n    } catch (error) {\n      log.error('Logout error in context', error as Error, { action: 'context_logout_error' })\n    } finally {\n      setUser(null)\n      setToken(null)\n      setPermissions([])\n      setError(null)\n      authService.clearAuthData()\n      router.replace(\"/login\")\n      \n      toast({\n        title: \"Logged Out\",\n        description: \"You have been successfully logged out.\",\n        variant: \"default\",\n      })\n    }\n  }\n\n  const refreshAuth = async (): Promise<void> => {\n    try {\n      const currentToken = authService.getStoredToken()\n      if (currentToken) {\n        await authService.refreshToken({ token: currentToken })\n        const newToken = authService.getStoredToken()\n        if (newToken) {\n          setToken(newToken)\n          log.info('Manual token refresh successful', { action: 'manual_token_refresh_success' })\n        }\n      }\n    } catch (error) {\n      log.error('Manual token refresh failed', error as Error, { action: 'manual_token_refresh_failed' })\n      await logout()\n    }\n  }\n\n  const value: AuthContextType = {\n    user,\n    token,\n    permissions,\n    isAuthenticated,\n    isLoading,\n    error,\n    login,\n    logout,\n    refreshAuth,\n  }\n\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>\n}\n\nexport function useAuth(): AuthContextType {\n  const context = useContext(AuthContext)\n  if (context === undefined) {\n    throw new Error(\"useAuth must be used within an AuthProvider\")\n  }\n  return context\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}